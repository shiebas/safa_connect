{% extends 'base.html' %}
{% load static %}
{% block title %}Register - SAFA ADMINISTRATION{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-md-10 col-lg-8">
      <div class="card" style="border: 2px solid var(--safa-black);">
        <div class="card-header text-center">
          <h2 class="mb-0">Register with SAFA</h2>
          <p class="text-muted">Register players, administrators, and club officials</p>
        </div>
        <div class="card-body">
          {% if messages %}
            {% for message in messages %}
              <div class="alert alert-{{ message.tags }}">{{ message }}</div>
            {% endfor %}
          {% endif %}

          <form method="post" enctype="multipart/form-data" novalidate
            data-id-number-id="{{ form.id_number.id_for_label }}"
            data-country-id="{{ form.country.id_for_label }}"
            data-dob-id="{{ form.date_of_birth.id_for_label }}"
            data-gender-id="{{ form.gender.id_for_label }}"
            data-id-doc-type-id="{{ form.id_document_type.id_for_label }}">
            {% csrf_token %}
            {% if form.non_field_errors %}
              <div class="alert alert-danger">
                {% for error in form.non_field_errors %}
                  <p>{{ error }}</p>
                {% endfor %}
              </div>
            {% endif %}

            <!-- 1. Account Info -->
            <h5 class="mb-3 mt-2">Account Information</h5>
            <div class="row mb-3">
              <div class="col-md-4 mb-3">
                <label for="{{ form.email.id_for_label }}" class="form-label">Email</label>
                {{ form.email }}
                {% if form.email.errors %}
                  <div class="text-danger">{% for error in form.email.errors %}<small>{{ error }}</small>{% endfor %}</div>
                {% endif %}
              </div>
              <div class="col-md-4 mb-3">
                <label for="{{ form.password1.id_for_label }}" class="form-label">Password</label>
                {{ form.password1 }}
                {% if form.password1.errors %}
                  <div class="text-danger">{% for error in form.password1.errors %}<small>{{ error }}</small>{% endfor %}</div>
                {% endif %}
              </div>
              <div class="col-md-4 mb-3">
                <label for="{{ form.password2.id_for_label }}" class="form-label">Confirm Password</label>
                {{ form.password2 }}
                {% if form.password2.errors %}
                  <div class="text-danger">{% for error in form.password2.errors %}<small>{{ error }}</small>{% endfor %}</div>
                {% endif %}
              </div>
            </div>

            <!-- 2. Personal Info -->
            <h5 class="mb-3 mt-4">Personal Information</h5>
            <div class="row mb-3">
              <div class="col-md-6 mb-3">
                <label for="{{ form.name.id_for_label }}" class="form-label">First Name</label>
                {{ form.name }}
                {% if form.name.errors %}
                  <div class="text-danger">{% for error in form.name.errors %}<small>{{ error }}</small>{% endfor %}</div>
                {% endif %}
              </div>
              <div class="col-md-6 mb-3">
                <label for="{{ form.surname.id_for_label }}" class="form-label">Surname</label>
                {{ form.surname }}
                {% if form.surname.errors %}
                  <div class="text-danger">{% for error in form.surname.errors %}<small>{{ error }}</small>{% endfor %}</div>
                {% endif %}
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-6 mb-3">
                <label for="{{ form.role.id_for_label }}" class="form-label">Role</label>
                {{ form.role }}
                {% if form.role.errors %}
                  <div class="text-danger">{% for error in form.role.errors %}<small>{{ error }}</small>{% endfor %}</div>
                {% endif %}
              </div>
            </div>

            <!-- 3. Identification -->
            <h5 class="mb-3 mt-4">Identification</h5>
            <div class="row mb-3">
              <div class="col-md-4 mb-3">
                <label for="{{ form.id_document_type.id_for_label }}" class="form-label">ID Document Type</label>
                {{ form.id_document_type }}
              </div>
              <div class="col-md-4 mb-3" id="id_number_box">
                <label for="{{ form.id_number.id_for_label }}" class="form-label">ID Number / Birth Certificate Number</label>
                {{ form.id_number }}
                {% if form.id_number.errors %}
                  <div class="text-danger">{% for error in form.id_number.errors %}<small>{{ error }}</small>{% endfor %}</div>
                {% endif %}
                <div id="id_number_error" class="text-danger" style="display:none;"></div>
                <!-- Date of Birth and Gender shown only if ID is valid -->
                <div id="id-extra-fields" style="display:none;">
                  <div class="mt-3">
                    <label for="{{ form.date_of_birth.id_for_label }}" class="form-label">Date of Birth</label>
                    {{ form.date_of_birth }}
                  </div>
                  <div class="mt-3">
                    <label for="{{ form.gender.id_for_label }}" class="form-label">Gender</label>
                    {{ form.gender }}
                  </div>
                </div>
              </div>
              <div class="col-md-4 mb-3" id="passport_box">
                <label for="{{ form.passport_number.id_for_label }}" class="form-label">Passport Number</label>
                {{ form.passport_number }}
                {% if form.passport_number.errors %}
                  <div class="text-danger">{% for error in form.passport_number.errors %}<small>{{ error }}</small>{% endfor %}</div>
                {% endif %}
              </div>
              <div class="col-md-4 mb-3" id="document_box">
                <label for="{{ form.document.id_for_label }}" class="form-label">Upload Document</label>
                {{ form.document }}
                {% if form.document.errors %}
                  <div class="text-danger">{% for error in form.document.errors %}<small>{{ error }}</small>{% endfor %}</div>
                {% endif %}
              </div>
            </div>

            <!-- 4. Country & Profile Photo -->
            <div class="row mb-3">
              <div class="col-md-6 mb-3 position-relative">
                <label for="{{ form.country.id_for_label }}" class="form-label">Country</label>
                <div class="input-group">
                  {{ form.country }}
                  <span id="country-flag" class="input-group-text" style="display:none;">
                    <img src="https://flagcdn.com/za.svg" alt="South Africa" width="24" height="16" style="margin-right:4px;">
                    <span id="country-code" style="font-weight:bold;">ZAF</span>
                  </span>
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <label for="{{ form.profile_photo.id_for_label }}" class="form-label">Profile Photo</label>
                {{ form.profile_photo }}
              </div>
            </div>

            <!-- 5. Register Button & Login Link -->
            <div class="d-grid gap-2 mt-4">
              <button type="submit" class="btn btn-dark">Register</button>
            </div>
            <div class="text-center mt-3">
              <p>Already have an account? <a href="{% url 'accounts:login' %}" style="color: var(--safa-black);">Login here</a></p>
            </div>
          </form>
        </div> <!-- card-body -->
      </div> <!-- card -->
    </div> <!-- col -->
  </div> <!-- row -->
</div> <!-- container -->
{% endblock %}

{% block extra_js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{% static 'js/registration.js' %}"></script>
{% endblock %}
