{% extends 'base.html' %}
{% load static %}

{% block title %}SAFA System Administrator Registration{% endblock %}

{% block content %}
<div class="container mt-5 mb-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header text-center">
                    <h2>SAFA System Administrator Registration</h2>
                </div>
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}

                        {% if form.errors %}
                            <div class="alert alert-danger">
                                <strong>Please correct the errors below:</strong>
                                <ul>
                                    {% for field, errors in form.errors.items %}
                                        {% for error in errors %}
                                            <li>{{ field|escape }}: {{ error|escape }}</li>
                                        {% endfor %}
                                    {% endfor %}
                                </ul>
                            </div>
                        {% endif %}

                        <fieldset>
                            <legend>Personal Information</legend>
                            <div class="row">
                                <div class="col-md-6 mb-3">{{ form.first_name.label_tag }} {{ form.first_name }}</div>
                                <div class="col-md-6 mb-3">{{ form.last_name.label_tag }} {{ form.last_name }}</div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">{{ form.email.label_tag }} {{ form.email }}</div>
                                <div class="col-md-6 mb-3">{{ form.phone_number.label_tag }} {{ form.phone_number }}</div>
                            </div>
                             <div class="mb-3">{{ form.profile_picture.label_tag }} {{ form.profile_picture }}</div>
                        </fieldset>

                        <fieldset>
                            <legend>Organization Information</legend>
                            <div class="mb-3">{{ form.organization_type.label_tag }} {{ form.organization_type }}</div>
                            <div class="mb-3">{{ form.position.label_tag }} {{ form.position }}</div>
                            <div class="mb-3" id="province-field" style="display:none;">{{ form.province.label_tag }} {{ form.province }}</div>
                            <div class="mb-3" id="region-field" style="display:none;">{{ form.region.label_tag }} {{ form.region }}</div>
                            <div class="mb-3" id="lfa-field" style="display:none;">{{ form.local_federation.label_tag }} {{ form.local_federation }}</div>
                            <div class="mb-3" id="club-field" style="display:none;">{{ form.club.label_tag }} {{ form.club }}</div>
                        </fieldset>

                        <fieldset>
                            <legend>Document Information</legend>
                            <div class="mb-3">{{ form.id_document_type.label_tag }} {{ form.id_document_type }}</div>
                            <div class="mb-3" id="sa-id-container">{{ form.id_number.label_tag }} {{ form.id_number }}</div>
                            <div class="mb-3" id="passport-container" style="display:none;">{{ form.passport_number.label_tag }} {{ form.passport_number }}</div>
                            <div class="row mb-3" id="dob-gender-manual-row" style="display:none;">
                                <div class="col-md-6">{{ form.date_of_birth.label_tag }} {{ form.date_of_birth }}</div>
                                <div class="col-md-6">{{ form.gender.label_tag }} {{ form.gender }}</div>
                            </div>
                            <div class="mb-3">{{ form.id_document.label_tag }} {{ form.id_document }}</div>
                        </fieldset>

                        <fieldset>
                            <legend>Security & Compliance</legend>
                             <div class="row">
                                <div class="col-md-6 mb-3">{{ form.password.label_tag }} {{ form.password }}</div>
                                <div class="col-md-6 mb-3">{{ form.password2.label_tag }} {{ form.password2 }}</div>
                            </div>
                            <div class="mb-3">{{ form.popi_act_consent.label_tag }} {{ form.popi_act_consent }}</div>
                        </fieldset>

                        <div class="text-center mt-4">
                            <button type="submit" class="btn btn-primary btn-lg">Register</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// This script block is intentionally left minimal to ensure form submission is not blocked.
// The dynamic showing/hiding of fields is removed for this debugging step.
// All validation will be handled by the server.
document.addEventListener('DOMContentLoaded', function() {
    // The dynamic field logic has been temporarily removed to guarantee submission.
    // We can add it back once we confirm the form submits correctly.
});
</script>
{% endblock %}